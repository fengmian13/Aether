<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.anther.mappers.ChatMessageMapper">

	<!--实体映射-->
	<resultMap id="base_result_map" type="com.anther.entity.po.ChatMessage">
		<!---->
		<id column="id" property="id"  />
		<!--会话ID-->
		<result column="session_id" property="sessionId"  />
		<!--1=私聊, 2=群聊, 3=会议聊天-->
		<result column="session_type" property="sessionType"  />
		<!--发送人ID-->
		<result column="send_user_id" property="sendUserId"  />
		<!--消息类型：1=文本, 2=图片, 3=视频, 4=文件, 5=撤回指令, 6=系统通知-->
		<result column="msg_type" property="msgType"  />
		<!--消息详情-->
		<result column="content" property="content"  />
		<!--发送时间-->
		<result column="send_time" property="sendTime"  />
		<!--接收人ID-->
		<result column="receive_user_id" property="receiveUserId"  />
		<!--文件大小-->
		<result column="file_size" property="fileSize"  />
		<!--文件名-->
		<result column="file_name" property="fileName"  />
		<!--文件后缀-->
		<result column="file_suffix" property="fileSuffix"  />
		<!--状态 0:正在发送 1:已发送-->
		<result column="status" property="status"  />
	</resultMap>


	<!-- 通用查询结果列-->
	<sql id="base_column_list">
		 id,session_id,session_type,send_user_id,msg_type,
		 content,send_time,receive_user_id,file_size,file_name,
		 file_suffix,status
	</sql>

	<sql id="base_condition_filed">
		<if test="query.id != null">
			 and  id = #{query.id}
		</if>
		<if test="query.sessionId != null and query.sessionId!=''">
			 and  session_id = #{query.sessionId}
		</if>
		<if test="query.sessionType != null">
			 and  session_type = #{query.sessionType}
		</if>
		<if test="query.sendUserId != null and query.sendUserId!=''">
			 and  send_user_id = #{query.sendUserId}
		</if>
		<if test="query.msgType != null">
			 and  msg_type = #{query.msgType}
		</if>
		<if test="query.content != null and query.content!=''">
			 and  content = #{query.content}
		</if>
		<if test="query.sendTime != null">
			 and  send_time = #{query.sendTime}
		</if>
		<if test="query.receiveUserId != null and query.receiveUserId!=''">
			 and  receive_user_id = #{query.receiveUserId}
		</if>
		<if test="query.fileSize != null">
			 and  file_size = #{query.fileSize}
		</if>
		<if test="query.fileName != null and query.fileName!=''">
			 and  file_name = #{query.fileName}
		</if>
		<if test="query.fileSuffix != null and query.fileSuffix!=''">
			 and  file_suffix = #{query.fileSuffix}
		</if>
		<if test="query.status != null">
			 and  status = #{query.status}
		</if>
	</sql>

	<!-- 通用查询条件列-->
	<sql id="query_condition">
		<where>
			<include refid="base_condition_filed" />
			<if test="query.sessionIdFuzzy!= null  and query.sessionIdFuzzy!=''">
				 and  session_id like concat('%', #{query.sessionIdFuzzy}, '%')
			</if>
			<if test="query.sendUserIdFuzzy!= null  and query.sendUserIdFuzzy!=''">
				 and  send_user_id like concat('%', #{query.sendUserIdFuzzy}, '%')
			</if>
			<if test="query.contentFuzzy!= null  and query.contentFuzzy!=''">
				 and  content like concat('%', #{query.contentFuzzy}, '%')
			</if>
			<if test="query.receiveUserIdFuzzy!= null  and query.receiveUserIdFuzzy!=''">
				 and  receive_user_id like concat('%', #{query.receiveUserIdFuzzy}, '%')
			</if>
			<if test="query.fileNameFuzzy!= null  and query.fileNameFuzzy!=''">
				 and  file_name like concat('%', #{query.fileNameFuzzy}, '%')
			</if>
			<if test="query.fileSuffixFuzzy!= null  and query.fileSuffixFuzzy!=''">
				 and  file_suffix like concat('%', #{query.fileSuffixFuzzy}, '%')
			</if>
		</where>
	</sql>

	<!-- 查询集合-->
	<select id="selectList" resultMap="base_result_map" >
		 SELECT <include refid="base_column_list" /> FROM chat_message <include refid="query_condition" />
		 <if test="query.orderBy!=null">
			 order by ${query.orderBy}
		 </if>
		 <if test="query.simplePage!=null">
			 limit #{query.simplePage.start},#{query.simplePage.end}
		 </if>
	</select>

	<!-- 查询数量-->
	<select id="selectCount" resultType="java.lang.Integer" >
		 SELECT count(1) FROM chat_message <include refid="query_condition" />
	</select>

	<!-- 插入 （匹配有值的字段）-->
	<insert id="insert" parameterType="com.anther.entity.po.ChatMessage">
		<selectKey keyProperty="bean.id" resultType="Long" order="AFTER">
			SELECT LAST_INSERT_ID()
		</selectKey>
		 INSERT INTO chat_message
		 <trim prefix="(" suffix=")" suffixOverrides="," >
			<if test="bean.sessionId != null">
				 session_id,
			</if>
			<if test="bean.sessionType != null">
				 session_type,
			</if>
			<if test="bean.sendUserId != null">
				 send_user_id,
			</if>
			<if test="bean.msgType != null">
				 msg_type,
			</if>
			<if test="bean.content != null">
				 content,
			</if>
			<if test="bean.sendTime != null">
				 send_time,
			</if>
			<if test="bean.receiveUserId != null">
				 receive_user_id,
			</if>
			<if test="bean.fileSize != null">
				 file_size,
			</if>
			<if test="bean.fileName != null">
				 file_name,
			</if>
			<if test="bean.fileSuffix != null">
				 file_suffix,
			</if>
			<if test="bean.status != null">
				 status,
			</if>
		 </trim>
		 <trim prefix="values (" suffix=")" suffixOverrides="," >
			<if test="bean.sessionId!=null">
				 #{bean.sessionId},
			</if>
			<if test="bean.sessionType!=null">
				 #{bean.sessionType},
			</if>
			<if test="bean.sendUserId!=null">
				 #{bean.sendUserId},
			</if>
			<if test="bean.msgType!=null">
				 #{bean.msgType},
			</if>
			<if test="bean.content!=null">
				 #{bean.content},
			</if>
			<if test="bean.sendTime!=null">
				 #{bean.sendTime},
			</if>
			<if test="bean.receiveUserId!=null">
				 #{bean.receiveUserId},
			</if>
			<if test="bean.fileSize!=null">
				 #{bean.fileSize},
			</if>
			<if test="bean.fileName!=null">
				 #{bean.fileName},
			</if>
			<if test="bean.fileSuffix!=null">
				 #{bean.fileSuffix},
			</if>
			<if test="bean.status!=null">
				 #{bean.status},
			</if>
		 </trim>
	</insert>

	<!-- 插入或者更新 （匹配有值的字段）-->
	<insert id="insertOrUpdate" parameterType="com.anther.entity.po.ChatMessage">
		 INSERT INTO chat_message
		 <trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">
				 id,
			</if>
			<if test="bean.sessionId != null">
				 session_id,
			</if>
			<if test="bean.sessionType != null">
				 session_type,
			</if>
			<if test="bean.sendUserId != null">
				 send_user_id,
			</if>
			<if test="bean.msgType != null">
				 msg_type,
			</if>
			<if test="bean.content != null">
				 content,
			</if>
			<if test="bean.sendTime != null">
				 send_time,
			</if>
			<if test="bean.receiveUserId != null">
				 receive_user_id,
			</if>
			<if test="bean.fileSize != null">
				 file_size,
			</if>
			<if test="bean.fileName != null">
				 file_name,
			</if>
			<if test="bean.fileSuffix != null">
				 file_suffix,
			</if>
			<if test="bean.status != null">
				 status,
			</if>
		 </trim>
		 <trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="bean.id!=null">
				 #{bean.id},
			</if>
			<if test="bean.sessionId!=null">
				 #{bean.sessionId},
			</if>
			<if test="bean.sessionType!=null">
				 #{bean.sessionType},
			</if>
			<if test="bean.sendUserId!=null">
				 #{bean.sendUserId},
			</if>
			<if test="bean.msgType!=null">
				 #{bean.msgType},
			</if>
			<if test="bean.content!=null">
				 #{bean.content},
			</if>
			<if test="bean.sendTime!=null">
				 #{bean.sendTime},
			</if>
			<if test="bean.receiveUserId!=null">
				 #{bean.receiveUserId},
			</if>
			<if test="bean.fileSize!=null">
				 #{bean.fileSize},
			</if>
			<if test="bean.fileName!=null">
				 #{bean.fileName},
			</if>
			<if test="bean.fileSuffix!=null">
				 #{bean.fileSuffix},
			</if>
			<if test="bean.status!=null">
				 #{bean.status},
			</if>
		 </trim>
		 on DUPLICATE key update 
		 <trim prefix="" suffix="" suffixOverrides=",">
			<if test="bean.sessionId!=null">
				 session_id = VALUES(session_id),
			</if>
			<if test="bean.sessionType!=null">
				 session_type = VALUES(session_type),
			</if>
			<if test="bean.sendUserId!=null">
				 send_user_id = VALUES(send_user_id),
			</if>
			<if test="bean.msgType!=null">
				 msg_type = VALUES(msg_type),
			</if>
			<if test="bean.content!=null">
				 content = VALUES(content),
			</if>
			<if test="bean.sendTime!=null">
				 send_time = VALUES(send_time),
			</if>
			<if test="bean.receiveUserId!=null">
				 receive_user_id = VALUES(receive_user_id),
			</if>
			<if test="bean.fileSize!=null">
				 file_size = VALUES(file_size),
			</if>
			<if test="bean.fileName!=null">
				 file_name = VALUES(file_name),
			</if>
			<if test="bean.fileSuffix!=null">
				 file_suffix = VALUES(file_suffix),
			</if>
			<if test="bean.status!=null">
				 status = VALUES(status),
			</if>
		 </trim>
	</insert>

	<!-- 添加 （批量插入）-->
	<insert id="insertBatch" parameterType="com.anther.entity.po.ChatMessage" useGeneratedKeys="true" keyProperty="id">
		 INSERT INTO chat_message(
			 session_id,
			 session_type,
			 send_user_id,
			 msg_type,
			 content,
			 send_time,
			 receive_user_id,
			 file_size,
			 file_name,
			 file_suffix,
			 status
		 )values
		 <foreach collection="list" item="item" separator=",">
			 (
				 #{item.sessionId},
				 #{item.sessionType},
				 #{item.sendUserId},
				 #{item.msgType},
				 #{item.content},
				 #{item.sendTime},
				 #{item.receiveUserId},
				 #{item.fileSize},
				 #{item.fileName},
				 #{item.fileSuffix},
				 #{item.status}
			 )
		 </foreach>
	</insert>

	<!-- 批量新增修改 （批量插入）-->
	<insert id="insertOrUpdateBatch" parameterType="com.anther.entity.po.ChatMessage">
		 INSERT INTO chat_message(
			 session_id,
			 session_type,
			 send_user_id,
			 msg_type,
			 content,
			 send_time,
			 receive_user_id,
			 file_size,
			 file_name,
			 file_suffix,
			 status
		 )values
		 <foreach collection="list" item="item" separator=",">
			 (
				 #{item.sessionId},
				 #{item.sessionType},
				 #{item.sendUserId},
				 #{item.msgType},
				 #{item.content},
				 #{item.sendTime},
				 #{item.receiveUserId},
				 #{item.fileSize},
				 #{item.fileName},
				 #{item.fileSuffix},
				 #{item.status}
			 )
		 </foreach>
			on DUPLICATE key update 
			session_id = VALUES(session_id),
			session_type = VALUES(session_type),
			send_user_id = VALUES(send_user_id),
			msg_type = VALUES(msg_type),
			content = VALUES(content),
			send_time = VALUES(send_time),
			receive_user_id = VALUES(receive_user_id),
			file_size = VALUES(file_size),
			file_name = VALUES(file_name),
			file_suffix = VALUES(file_suffix),
			status = VALUES(status)
	</insert>

	<!--多条件修改-->
	<update id="updateByParam" parameterType="com.anther.entity.query.ChatMessageQuery">
		 UPDATE chat_message
 		 <set> 
			<if test="bean.sessionId != null">
				 session_id = #{bean.sessionId},
			</if>
			<if test="bean.sessionType != null">
				 session_type = #{bean.sessionType},
			</if>
			<if test="bean.sendUserId != null">
				 send_user_id = #{bean.sendUserId},
			</if>
			<if test="bean.msgType != null">
				 msg_type = #{bean.msgType},
			</if>
			<if test="bean.content != null">
				 content = #{bean.content},
			</if>
			<if test="bean.sendTime != null">
				 send_time = #{bean.sendTime},
			</if>
			<if test="bean.receiveUserId != null">
				 receive_user_id = #{bean.receiveUserId},
			</if>
			<if test="bean.fileSize != null">
				 file_size = #{bean.fileSize},
			</if>
			<if test="bean.fileName != null">
				 file_name = #{bean.fileName},
			</if>
			<if test="bean.fileSuffix != null">
				 file_suffix = #{bean.fileSuffix},
			</if>
			<if test="bean.status != null">
				 status = #{bean.status},
			</if>
 		 </set>
 		 <include refid="query_condition" />
	</update>

	<!--多条件删除-->
	<delete id="deleteByParam">
		 delete from chat_message
 		 <include refid="query_condition" />
	</delete>

	<!-- 根据Id修改-->
	<update id="updateById" parameterType="com.anther.entity.po.ChatMessage">
		 UPDATE chat_message
 		 <set> 
			<if test="bean.sessionId != null">
				 session_id = #{bean.sessionId},
			</if>
			<if test="bean.sessionType != null">
				 session_type = #{bean.sessionType},
			</if>
			<if test="bean.sendUserId != null">
				 send_user_id = #{bean.sendUserId},
			</if>
			<if test="bean.msgType != null">
				 msg_type = #{bean.msgType},
			</if>
			<if test="bean.content != null">
				 content = #{bean.content},
			</if>
			<if test="bean.sendTime != null">
				 send_time = #{bean.sendTime},
			</if>
			<if test="bean.receiveUserId != null">
				 receive_user_id = #{bean.receiveUserId},
			</if>
			<if test="bean.fileSize != null">
				 file_size = #{bean.fileSize},
			</if>
			<if test="bean.fileName != null">
				 file_name = #{bean.fileName},
			</if>
			<if test="bean.fileSuffix != null">
				 file_suffix = #{bean.fileSuffix},
			</if>
			<if test="bean.status != null">
				 status = #{bean.status},
			</if>
 		 </set>
 		 where id=#{id}
	</update>

	<!-- 根据Id删除-->
	<delete id="deleteById">
		delete from chat_message where id=#{id}
	</delete>

	<!-- 根据PrimaryKey获取对象-->
	<select id="selectById" resultMap="base_result_map" >
		select <include refid="base_column_list" /> from chat_message where id=#{id}
	</select>

</mapper>